apiVersion: chainsaw.kyverno.io/v1alpha1
kind: Test
metadata:
  name: sib-deletion
spec:
  timeouts:
    assert: 10s
  steps:
  - name: 01-Create-Resources
    try:
      - apply:
          file: ../../../examples/namespaced/dns-manipulation-si-sib.yaml
      - assert:
          file: ../../../examples/namespaced/dns-manipulation-si-sib.yaml
  - name: 02-Delete-SIB
    try:
      # - delete:
      #     ref:
      #       apiVersion: intent.security.nimbus.com/v1
      #       kind: SecurityIntentBinding
      #       name: dns-manipulation-binding
      #     expect:
      #     - match:
      #         apiVersion: intent.security.nimbus.com/v1
      #         kind: SecurityIntentBinding
      #         name: dns-manipulation-binding
      #       check:
      #         ($error != null): true
      - script:
          content: kubectl delete sib dns-manipulation-binding -n $NAMESPACE

  - name: step-03
    try:
    - sleep:
        duration: 5s
              
  - name: 04-Assert-NP-Deletion
    try:
      - script:
          content: kubectl get np -n $NAMESPACE dns-manipulation-binding
          check: 
            ($error != null): true

    
