apiVersion: kyverno.io/v1
kind: Policy
metadata:
  annotations:
    app.kubernetes.io/managed-by: nimbus-kyverno
    policies.kyverno.io/description: Ensure workload is encryted by running the specified
      workload in a Confidential VM
  name: coco-workload-binding-mutateexisting
  ownerReferences:
  - apiVersion: intent.security.nimbus.com/v1alpha1
    blockOwnerDeletion: true
    controller: true
    kind: NimbusPolicy
    name: coco-workload-binding
spec:
  admission: true
  background: true
  mutateExistingOnPolicyUpdate: true
  rules:
  - exclude:
      resources: {}
    generate:
      clone: {}
      cloneList: {}
    match:
      any:
      - resources:
          kinds:
          - v1/ConfigMap
          name: coco-workload-binding-mutateexisting-trigger-configmap
      resources: {}
    mutate:
      patchStrategicMerge:
        spec:
          template:
            spec:
              runtimeClassName: kata-clh
      targets:
      - apiVersion: apps/v1
        kind: Deployment
        name: nginx
    name: add runtime
    skipBackgroundRequests: true
    validate: {}
  validationFailureAction: Enforce
